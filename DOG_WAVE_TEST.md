# Dog招手动作测试指南

## 修复内容总结

已修复dog板子招手动作中，两条后腿（坐下状态）和右前腿抽动的问题。

## 测试步骤

### 1. 编译固件

```bash
cd /Users/machenyang/Desktop/xz1-main
./compile_dog.sh
```

### 2. 烧录固件

```bash
./完整烧录.sh
```

或者使用VSCode的烧录功能。

### 3. 测试招手动作

通过MCP接口调用招手动作：

```
self.dog.say_hello
```

可选参数：
- `wave_times`: 招手次数（默认5次）
- `speed`: 招手速度（默认500ms）
- `amount`: 摆动幅度（默认30度）

示例：
```
self.dog.say_hello(wave_times=3, speed=400, amount=25)
```

### 4. 观察要点

#### ✅ 应该看到的正常现象：

1. **第1步（坐下）：**
   - 两条后腿平滑向前移动（坐下姿势）
   - 两条前腿保持中立位置

2. **第2步（招手）：**
   - **左前腿** 平滑地来回摆动（招手动作）
   - **左后腿** 完全静止在坐下位置 ✨ **重点观察**
   - **右前腿** 完全静止在中立位置 ✨ **重点观察**
   - **右后腿** 完全静止在坐下位置 ✨ **重点观察**

3. **第3步（收手）：**
   - 左前腿平滑回到中立位置
   - 其他三条腿保持不动

4. **第4步（站起）：**
   - 两条后腿平滑回到中立位置（站起）
   - 所有腿回到中立

#### ❌ 不应该出现的现象：

- 两条后腿在招手时抽动或颤抖
- 右前腿在招手时抽动或颤抖
- 任何不该动的腿出现微小摆动

## 与其他动作的兼容性测试

修改只影响招手动作，请确认以下动作仍正常工作：

### 前进
```
self.dog.walk_forward(steps=4)
```

### 后退
```
self.dog.walk_backward(steps=4)
```

### 右转
```
self.dog.turn_right(steps=4)
```

### 左转
```
self.dog.turn_left(steps=4)
```

### 回到中立位置
```
self.dog.home()
```

## 技术说明

### 修改原理

原来的实现每次都移动所有舵机，即使目标位置没变：
```cpp
// 问题：每次循环都会尝试移动所有舵机
MoveServosWithEase(period / 2, all_servos_target, EASE_IN_OUT);
```

新的实现只移动需要移动的舵机：
```cpp
// 修复：只移动招手的腿
MoveSingleServoWithEase(LEFT_FRONT_LEG, wave_forward, period / 2, EASE_IN_OUT);
```

### 关键改进点

1. **锁定位置：** 在招手前设置其他三条腿的位置，让它们稳定
2. **单舵机控制：** 招手时只控制左前腿，其他腿完全不触碰
3. **避免累积误差：** 不读取不需要移动的舵机位置，自然没有抖动

## 预期效果

- ✅ 招手动作流畅自然
- ✅ 坐下的两条后腿完全静止
- ✅ 右前腿（支撑腿）完全静止
- ✅ 只有左前腿在摆动
- ✅ 不影响其他任何功能

## 如果还有问题

如果测试后仍有抖动，可能的原因和解决方案：

### 1. 舵机硬件问题
- 检查舵机是否松动
- 检查舵机供电是否稳定
- 检查舵机是否损坏

### 2. 参数调整
可以尝试调整参数：

```cpp
// 减小摆动幅度
self.dog.say_hello(wave_times=3, speed=500, amount=20)

// 增加稳定时间（修改代码）
vTaskDelay(pdMS_TO_TICKS(500));  // 原来是300
```

### 3. 微调值
如果某条腿的中立位置不对，可以设置微调：

```
self.dog.set_trim(left_rear=0, left_front=0, right_front=0, right_rear=0)
```

## 反馈

测试完成后，请反馈：
1. 抖动问题是否已解决？
2. 其他动作是否正常？
3. 是否有新的问题？

---

**修复日期：** 2026-01-08  
**修改文件：**
- `main/boards/dog/dog_movements.h`
- `main/boards/dog/dog_movements.cc`

