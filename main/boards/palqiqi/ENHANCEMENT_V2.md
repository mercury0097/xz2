# 🚀 Pet-like Life System V2 - 增强版改进说明

## 📝 您的反馈

> "随机动作也很微小，其他没有任何区别"

## ✅ V2 改进内容

### 1. **自动动作表现力增强** 🎭

#### 原版（V1）：
- 只有3个微动作：轻微重心调整、微抖动、5-10度转身
- 动作幅度很小，不明显

#### 增强版（V2）：
- **6种自动动作**，表现力更强：
  1. **重心调整** - 2-3次上下摆动，幅度15-25度
  2. **脚部调整** - 3-5次抖动，幅度8-15度
  3. **小幅转身** - 15-30度转身，50%概率转回来
  4. **环顾四周** ⭐ NEW - 左右摇摆2次，像在观察
  5. **伸展身体** ⭐ NEW - 踮脚摇摆，像伸懒腰
  6. **抖腿** ⭐ NEW - 抖腿动作，很有"活物"感

```cpp
// 对比示例
// V1: palqiqi_.UpDown(1, 1000, 5);  // 1次，5度
// V2: palqiqi_.UpDown(2-3次, 800, 15-25度);  // 更明显
```

---

### 2. **触发频率提升** ⚡

#### 参数调整：

| 参数 | V1 | V2 | 效果 |
|------|----|----|------|
| `URGE_TRIGGER_THRESHOLD` | 70 | **50** | 更容易触发（约60秒 vs 140秒） |
| `HOLD_BACK_PROBABILITY` | 45% | **30%** | 更容易动（70%概率 vs 55%） |
| `URGE_RISE_RATE` | 0.3 | **0.6** | urge增长快2倍 |
| `ENERGY_RECOVER_RATE` | 0.2 | **0.3** | 能量恢复快50% |

**实际效果**：
- V1: 平均 2-3 分钟动一次
- V2: 平均 **1-1.5 分钟动一次**

---

### 3. **犹豫感增强** 🤔

#### 原版（V1）：
```
犹豫 200-600ms → 执行动作
```

#### 增强版（V2）：
```
犹豫 300-800ms（更长）
↓
如果犹豫 > 500ms：做轻微"准备动作"（可见！）
↓
执行主动作
```

**可见效果**：
- 用户说"跳一下"
- 机器人先轻微调整重心（表示"我在准备"）
- 然后才跳

**日志增强**：
```
⏱️  犹豫 650ms... (像在思考)
```

---

### 4. **语音一致性增强** 🗣️

#### 增加更多话术变体：

**动作前（短ACK）**：
```
V1: 4种 → V2: 7种
新增：
- "稍等，让我想想..."
- "好的，等我调整一下"
- "嗯...我动动看"
```

**动作完成后**：
```
V1: 4种 → V2: 7种
新增：
- "搞定！"
- "怎么样？"
- "嘿嘿，做完了"
```

**日志增强**：
```
🗣️  [动作前承诺] 好，我试试。
✅ [动作完成确认] 做到了！ (action: walk)
```

---

### 5. **动作池智能化** 🧠

#### 根据状态选择动作：

| Attention | Energy | 允许的动作 |
|-----------|--------|-----------|
| < 20 | 任意 | 重心调整、脚部调整、抖腿 |
| 20-40 | 任意 | + 环顾四周、伸展身体 |
| 40-60 | 任意 | + 小幅转身（更活跃） |
| 60+ | 任意 | 最活跃的动作组合 |
| 任意 | < 30 | 只允许最小动作 |
| 任意 | 30-50 | 排除耗能动作（转身） |

**智能过滤**：
- 能量低时自动限制动作幅度
- 注意力高时动作更丰富
- 注意力低时只做小调整

---

## 🎯 现在的体验对比

### V1 体验：
```
[启动]
...等待 2-3 分钟...
[轻微抖动一下，几乎看不出]
...等待 2-3 分钟...
[又抖了一下]
```

### V2 体验：
```
[启动]
...等待 1 分钟左右...
[明显的重心调整，2-3次摆动]
...等待 1 分钟...
[转身15度，看看周围，又转回来]
...等待 1 分钟...
[抖腿2次，很有"活物"感]
...等待 1 分钟...
[踮脚伸懒腰]
```

### 交互体验：

**用户**: "跳一下"

**V1**:
```
AI: "好，我试试。"
[立刻开始跳]
AI: "做到了！"
```

**V2**:
```
AI: "稍等，让我想想..."
[轻微调整重心，表示"准备中"]
[犹豫 500-800ms]
[开始跳，幅度和速度略有随机]
[平滑收尾]
AI: "嘿嘿，做完了"
```

---

## 📊 数据对比

| 指标 | V1 | V2 | 提升 |
|------|----|----|------|
| 自动动作种类 | 3 | 6 | **+100%** |
| 触发频率 | 2-3分钟/次 | 1-1.5分钟/次 | **+50%** |
| 动作幅度 | 5-10度 | 15-30度 | **+200%** |
| 犹豫时长 | 200-600ms | 300-800ms | **+33%** |
| 话术变体 | 8种 | 14种 | **+75%** |
| urge增长速度 | 0.3/tick | 0.6/tick | **+100%** |

---

## 🔧 如果还想更活跃

### 进一步调整参数：

```cpp
// 在 palqiqi_controller.cc 顶部

// 🔥 "超活跃"模式
#define URGE_TRIGGER_THRESHOLD 40        // 降到40（原50）
#define HOLD_BACK_PROBABILITY 15         // 降到15%（原30%）

// 在 life_loop.h 中
static constexpr float URGE_RISE_RATE = 0.8f;  // 改成0.8（原0.6）
```

**效果**：约 **30-45秒** 就会动一次

---

## 🐛 如果还是感觉不明显

### 检查清单：

1. **确认已烧录 V2 固件**
   ```bash
   idf.py build flash
   ```

2. **查看串口日志**
   ```bash
   idf.py monitor
   ```
   
   应该看到：
   ```
   🧬 Life-Driven Behavior Task started
   📊 Thresholds: urge=50, attention_suppress=60, holdback=30%
   🎬 Auto-action triggered! (A=45 U=52 E=68)
   🐾 重心调整 - Shift weight
   ⏱️  犹豫 650ms... (像在思考)
   ✅ Action complete (energy cost: 2)
   ```

3. **等待足够时间**
   - 第一次触发：约 **60-90秒**（urge 0→50）
   - 后续触发：约 **60-90秒**（冷却结束后）

4. **观察动作细节**
   - 动作前有短暂停顿（犹豫）
   - 动作幅度明显（15-30度，不是5度）
   - 动作后平滑回到默认姿态

---

## 🎨 性格调参指南

### "安静宠物"（动得少但有质量）：
```cpp
URGE_TRIGGER_THRESHOLD = 60
HOLD_BACK_PROBABILITY = 40
URGE_RISE_RATE = 0.4f
```

### "活泼宠物"（当前V2）：
```cpp
URGE_TRIGGER_THRESHOLD = 50
HOLD_BACK_PROBABILITY = 30
URGE_RISE_RATE = 0.6f
```

### "多动症宠物"（非常活跃）：
```cpp
URGE_TRIGGER_THRESHOLD = 35
HOLD_BACK_PROBABILITY = 15
URGE_RISE_RATE = 0.9f
```

---

## 📝 完整改动文件列表

1. ✅ `palqiqi_controller.cc`
   - 降低触发阈值（70→50）
   - 降低忍耐概率（45%→30%）
   - 增强6个自动动作的表现力
   - 增加3个新动作（环顾、伸展、抖腿）
   - 增强犹豫期的可见性
   - 优化动作池智能选择

2. ✅ `life_loop.h`
   - 加快urge增长（0.3→0.6）
   - 加快能量恢复（0.2→0.3）

3. ✅ `speech_wrapper.cc`
   - 增加话术变体（8→14种）
   - 增强日志可见度

---

## 🚀 下一步

### 立即体验：
```bash
cd /Users/machenyang/Desktop/xz1-main
idf.py build flash monitor
```

### 观察重点：
1. ✅ 启动后 **1分钟内** 应该有第一次自动动作
2. ✅ 动作应该 **明显可见**（不是微抖）
3. ✅ 说话时应该先说"我试试"，动完才说"做到了"
4. ✅ 动作前有 **可见的犹豫/准备**

---

**如果还有问题，请告诉我具体哪里不满意！** 🐾


