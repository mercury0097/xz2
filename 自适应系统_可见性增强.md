# ğŸ” è‡ªé€‚åº”ç³»ç»Ÿ - å¯è§æ€§å¢å¼º

## ğŸ“‹ é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šæ— æ³•ç›´æ¥è®¾ç½®å® ç‰©å±æ€§

**ç”¨æˆ·éœ€æ±‚**ï¼š
```
"æŠŠæ¸…æ´åº¦è®¾ç½®åˆ°10" â†’ AI åº”è¯¥èƒ½ç›´æ¥è®¾ç½®
"æŠŠé¥¥é¥¿åº¦è®¾ç½®åˆ°20" â†’ AI åº”è¯¥èƒ½ç›´æ¥è®¾ç½®
```

**åŸæœ‰é™åˆ¶**ï¼š
- AI åªèƒ½è°ƒç”¨ `self.pet.clean`ï¼ˆ+15æ¸…æ´åº¦ï¼‰
- AI åªèƒ½è°ƒç”¨ `self.pet.feed`ï¼ˆ+20é¥±è…¹åº¦ï¼‰
- æ— æ³•ç²¾ç¡®è®¾ç½®åˆ°æŒ‡å®šå€¼

**âœ… è§£å†³æ–¹æ¡ˆ**ï¼š

æ·»åŠ äº†æ–°çš„ MCP å·¥å…·ï¼š`self.pet.set_state`

```cpp
AddTool("self.pet.set_state", 
    "Directly set pet state values (for testing/debugging). Use this when user explicitly asks to set specific values.\n"
    "Examples:\n"
    "- \"æŠŠæ¸…æ´åº¦è®¾ç½®åˆ°10\" â†’ set_state(cleanliness=10)\n"
    "- \"æŠŠé¥¥é¥¿åº¦è®¾ç½®åˆ°20\" â†’ set_state(satiety=20)\n"
    "- \"æŠŠå¿ƒæƒ…è®¾ç½®åˆ°50\" â†’ set_state(mood=50)\n"
    "\n"
    "NOTE: This bypasses natural game mechanics. Only use when user explicitly requests it.",
    PropertyList({
        Property("mood", kPropertyTypeInteger, 70, 0, 100),
        Property("satiety", kPropertyTypeInteger, 70, 0, 100),
        Property("cleanliness", kPropertyTypeInteger, 70, 0, 100)
    }),
    ...
);
```

**ä½¿ç”¨æ–¹æ³•**ï¼š

åœ¨å¯¹è¯ä¸­è¯´ï¼š
```
"æŠŠæ¸…æ´åº¦è®¾ç½®åˆ°10"
```

AI ä¼šè°ƒç”¨ï¼š
```
% self.pet.set_state(cleanliness=10)...
```

é¢„æœŸæ—¥å¿—ï¼š
```
I (xxx) Pet: ğŸ”§ Debug set: Mood=70, Satiety=70, Clean=10
```

---

### é—®é¢˜ 2ï¼šçœ‹ä¸åˆ°è‡ªé€‚åº”å’Œæƒ…ç»ªç´¯ç§¯çš„æ•ˆæœ

**ç”¨æˆ·åé¦ˆ**ï¼š
```
"æˆ‘æ²¡æœ‰ä½“ä¼šåˆ°è‡ªé€‚åº”å’Œæƒ…ç»ªç´¯ç§¯"
```

**åŸå› åˆ†æ**ï¼š

1. **æ—¥å¿—çº§åˆ«å¤ªä½**ï¼š
   - åŸå…ˆï¼š`ESP_LOGD`ï¼ˆDEBUG çº§åˆ«ï¼Œé»˜è®¤ä¸æ˜¾ç¤ºï¼‰
   - ç”¨æˆ·çœ‹ä¸åˆ°è‡ªé€‚åº”è¡°å‡é€Ÿç‡çš„å˜åŒ–

2. **äº’åŠ¨æ¬¡æ•°å¤ªå°‘**ï¼š
   - ç”¨æˆ·åªäº’åŠ¨äº† 5 æ¬¡ï¼ˆæä½é¢‘ï¼‰
   - è‡ªé€‚åº”æ•ˆæœä¸æ˜æ˜¾ï¼ˆè¡°å‡é€Ÿç‡ 1.0xï¼‰

**âœ… è§£å†³æ–¹æ¡ˆ**ï¼š

#### 1. å¢å¼ºæ—¥å¿—å¯è§æ€§

**å® ç‰©è¡°å‡æ—¥å¿—**ï¼ˆ`pet_system.cc`ï¼‰ï¼š
```cpp
// ä¹‹å‰ï¼ˆDEBUGï¼Œä¸æ˜¾ç¤ºï¼‰
ESP_LOGD(TAG, "ğŸ”„ Decay applied: adaptive_rate=%.2f, ...");

// ç°åœ¨ï¼ˆINFOï¼Œæ¯æ¬¡éƒ½æ˜¾ç¤ºï¼‰
ESP_LOGI(TAG, "ğŸ”„ Decay: adaptive_rate=%.2fx (7däº’åŠ¨=%uæ¬¡), mood=%dâ†’%d, satiety=%d, clean=%d",
         adaptive_rate,
         xiaozhi::UserProfile::GetInstance().GetInteractionCount7d(),
         old_mood, state_.mood, state_.satiety, state_.cleanliness);
```

**æƒ…ç»ªè®°å¿†æ—¥å¿—**ï¼ˆ`emotional_memory.cc`ï¼‰ï¼š
```cpp
// ä¹‹å‰ï¼ˆDEBUGï¼Œä¸æ˜¾ç¤ºï¼‰
ESP_LOGD(TAG, "Recorded play: excitement=%d, loneliness=%d");

// ç°åœ¨ï¼ˆINFOï¼Œè¯¦ç»†æ˜¾ç¤ºï¼‰
ESP_LOGI(TAG, "ğŸ’ Play: excitement=%dâ†‘, loneliness=%dâ†“, happiness=%.2f");
ESP_LOGI(TAG, "ğŸ’ Feed: happiness=%.2fâ†‘, loneliness=%dâ†“");
ESP_LOGI(TAG, "ğŸ’ Hug: trust=%dâ†‘ (total hugs=%u), happiness=%.2fâ†‘");
```

#### 2. ç°åœ¨çš„æ—¥å¿—è¾“å‡º

**æ¯æ¬¡å® ç‰©è¡°å‡æ—¶**ï¼ˆæ¯åˆ†é’Ÿï¼‰ï¼š
```
I (xxx) Pet: ğŸ”„ Decay: adaptive_rate=1.00x (7däº’åŠ¨=5æ¬¡), mood=75â†’74, satiety=89, clean=84
```

**æ¯æ¬¡äº’åŠ¨æ—¶**ï¼š
```
I (xxx) Pet: ğŸ” Fed pet +20, Satiety: 70 -> 90
I (xxx) EmotionalMemory: ğŸ’ Feed: happiness=0.15â†‘, loneliness=40â†“

I (xxx) Pet: ğŸ¾ Played with pet, Mood: 78, Active: 53
I (xxx) EmotionalMemory: ğŸ’ Play: excitement=65â†‘, loneliness=30â†“, happiness=0.25

I (xxx) Pet: ğŸ¤— Hugged pet, Mood: 88
I (xxx) EmotionalMemory: ğŸ’ Hug: trust=73â†‘ (total hugs=10), happiness=0.33â†‘
```

---

## ğŸ§ª å¦‚ä½•ä½“éªŒè‡ªé€‚åº”æ•ˆæœ

### æµ‹è¯• 1ï¼šä½é¢‘ç”¨æˆ·ï¼ˆå½“å‰çŠ¶æ€ï¼‰

**å½“å‰äº’åŠ¨æ¬¡æ•°**ï¼š5 æ¬¡ï¼ˆ7å¤©å†…ï¼‰

**é¢„æœŸæ—¥å¿—**ï¼š
```
I (xxx) Pet: ğŸ”„ Decay: adaptive_rate=0.60x (7däº’åŠ¨=5æ¬¡), mood=70â†’69, satiety=89, clean=84
```

**æ•ˆæœ**ï¼š
- è¡°å‡é€Ÿç‡ **0.6x**ï¼ˆå‡æ…¢ 40%ï¼‰
- å® ç‰©è¡°å‡å¾ˆæ…¢ï¼Œå‡å°‘æ‰“æ‰°
- è­¦å‘Šé˜ˆå€¼ï¼š-5ï¼ˆæ›´æ™šè­¦å‘Šï¼‰

---

### æµ‹è¯• 2ï¼šä¸­é¢‘ç”¨æˆ·

**ç›®æ ‡äº’åŠ¨æ¬¡æ•°**ï¼š20 æ¬¡ï¼ˆ7å¤©å†…ï¼‰

**æ“ä½œæ–¹æ³•**ï¼š
```
å¤šæ¬¡å¯¹è¯ï¼š
"å–‚å® ç‰©"
"ç©è€"
"æ´—æ¾¡"
"æŠ±æŠ±"
"æŸ¥è¯¢çŠ¶æ€"
```

é‡å¤ 20 æ¬¡ã€‚

**é¢„æœŸæ—¥å¿—**ï¼š
```
I (xxx) Pet: ğŸ”„ Decay: adaptive_rate=1.00x (7däº’åŠ¨=20æ¬¡), mood=75â†’74, satiety=88, clean=83
```

**æ•ˆæœ**ï¼š
- è¡°å‡é€Ÿç‡ **1.0x**ï¼ˆæ­£å¸¸ï¼‰
- æ ‡å‡†ç…§é¡¾èŠ‚å¥
- è­¦å‘Šé˜ˆå€¼ï¼š0ï¼ˆä¸è°ƒæ•´ï¼‰

---

### æµ‹è¯• 3ï¼šé«˜é¢‘ç”¨æˆ·

**ç›®æ ‡äº’åŠ¨æ¬¡æ•°**ï¼š50+ æ¬¡ï¼ˆ7å¤©å†…ï¼‰

**æ“ä½œæ–¹æ³•**ï¼š
```
é¢‘ç¹å¯¹è¯å’Œäº’åŠ¨ï¼ˆ50+ æ¬¡ï¼‰
```

**é¢„æœŸæ—¥å¿—**ï¼š
```
I (xxx) Pet: ğŸ”„ Decay: adaptive_rate=1.30x (7däº’åŠ¨=52æ¬¡), mood=80â†’78, satiety=85, clean=80
```

**æ•ˆæœ**ï¼š
- è¡°å‡é€Ÿç‡ **1.3x**ï¼ˆåŠ å¿« 30%ï¼‰
- å® ç‰©éœ€è¦æ›´é¢‘ç¹ç…§é¡¾
- è­¦å‘Šé˜ˆå€¼ï¼š+5ï¼ˆæ›´æ—©è­¦å‘Šï¼‰
- è¡¨æƒ…æ´»è·ƒåº¦ï¼š75/100ï¼ˆæ›´ä¸°å¯Œï¼‰

---

### æµ‹è¯• 4ï¼šæƒ…ç»ªç´¯ç§¯ï¼ˆé•¿æœŸï¼‰

**æ“ä½œæ–¹æ³•**ï¼š
```
1. å¤šæ¬¡æ‹¥æŠ±ï¼ˆ10+ æ¬¡ï¼‰
2. å¤šæ¬¡ç©è€ï¼ˆ20+ æ¬¡ï¼‰
3. é•¿æ—¶é—´ä¸äº’åŠ¨ï¼ˆ6+ å°æ—¶ï¼‰
```

**é¢„æœŸæ—¥å¿—ï¼ˆæ‹¥æŠ±ï¼‰**ï¼š
```
I (xxx) EmotionalMemory: ğŸ’ Hug: trust=55â†‘ (total hugs=1), happiness=0.08â†‘
I (xxx) EmotionalMemory: ğŸ’ Hug: trust=58â†‘ (total hugs=2), happiness=0.16â†‘
I (xxx) EmotionalMemory: ğŸ’ Hug: trust=61â†‘ (total hugs=3), happiness=0.24â†‘
...
I (xxx) EmotionalMemory: ğŸ’ Hug: trust=85â†‘ (total hugs=10), happiness=0.80â†‘
```

**é¢„æœŸæ—¥å¿—ï¼ˆå­¤ç‹¬ï¼‰**ï¼š
```
// è¶…è¿‡ 6 å°æ—¶æœªäº’åŠ¨
I (xxx) EmotionalMemory: Loneliness increased to 75 (6h+ no interaction)
I (xxx) Pet: ğŸ’­ Longterm response: ä¸»äººï¼Œæˆ‘æ„Ÿè§‰æœ‰ç‚¹å­¤å•...èƒ½å¤šé™ªé™ªæˆ‘å—ï¼Ÿ
```

---

## ğŸ“Š è‡ªé€‚åº”æ•ˆæœå¯¹æ¯”

### æ•°æ®è¡¨æ ¼

| ç”¨æˆ·ç±»å‹ | 7å¤©äº’åŠ¨æ¬¡æ•° | è¡°å‡é€Ÿç‡ | è­¦å‘Šé˜ˆå€¼ | è¡¨æƒ…æ´»è·ƒåº¦ | ä½“éªŒç‰¹ç‚¹ |
|----------|-------------|----------|----------|------------|----------|
| **æä½é¢‘** | 0-5 æ¬¡ | 0.6x | -5 | 35/100 | è¡°å‡æ…¢ï¼Œå‡å°‘æ‰“æ‰° |
| **ä½é¢‘** | 6-15 æ¬¡ | 0.8x | -5 | 40/100 | è¡°å‡è¾ƒæ…¢ |
| **ä¸­é¢‘** | 16-30 æ¬¡ | 1.0x | 0 | 55/100 | æ ‡å‡†èŠ‚å¥ |
| **ä¸­é«˜é¢‘** | 31-50 æ¬¡ | 1.2x | +5 | 65/100 | è¡°å‡è¾ƒå¿« |
| **é«˜é¢‘** | 51+ æ¬¡ | 1.3x | +5 | 75/100 | è¡°å‡å¿«ï¼Œé™ªä¼´æ„Ÿå¼º |

### æƒ…ç»ªç´¯ç§¯æ•ˆæœ

| äº’åŠ¨ç±»å‹ | ä¿¡ä»»åº¦å˜åŒ– | å­¤ç‹¬æ„Ÿå˜åŒ– | å…´å¥‹åº¦å˜åŒ– | å¿«ä¹è¶‹åŠ¿ |
|----------|------------|------------|------------|----------|
| **å–‚é£Ÿ** | 0 | -10 | 0 | +0.05 |
| **ç©è€** | 0 | -20 | +15 | +0.10 |
| **æ‹¥æŠ±** | +3 | -15 | 0 | +0.08 |
| **æ¸…æ´** | 0 | 0 | 0 | 0 |

**é•¿æœŸç´¯ç§¯**ï¼š
- æ‹¥æŠ± 30 æ¬¡ â†’ ä¿¡ä»»åº¦ +90
- ç©è€ 100 æ¬¡ â†’ ä¿¡ä»»åº¦ç¼“æ…¢å¢é•¿ï¼ˆæ¯å¤©+1ï¼‰
- è¶…è¿‡ 7 å¤©æœªäº’åŠ¨ â†’ ä¿¡ä»»åº¦ -1/å¤©

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•æµç¨‹

### 1. ç¼–è¯‘å’Œçƒ§å½•

```bash
cd /Users/machenyang/Desktop/xiaozhi-esp32-main
idf.py build flash monitor
```

### 2. ç›´æ¥è®¾ç½®æµ‹è¯•

åœ¨å¯¹è¯ä¸­è¯´ï¼š
```
"æŠŠæ¸…æ´åº¦è®¾ç½®åˆ°10"
"æŠŠé¥±è…¹åº¦è®¾ç½®åˆ°20"
"æŠŠå¿ƒæƒ…è®¾ç½®åˆ°30"
```

### 3. è§‚å¯Ÿæ—¥å¿—

**è®¾ç½®å**ï¼š
```
I (xxx) Pet: ğŸ”§ Debug set: Mood=30, Satiety=20, Clean=10
```

**1åˆ†é’Ÿåï¼ˆè¡°å‡ï¼‰**ï¼š
```
I (xxx) Pet: ğŸ”„ Decay: adaptive_rate=0.60x (7däº’åŠ¨=5æ¬¡), mood=30â†’29, satiety=19, clean=9
```

### 4. å¤šæ¬¡äº’åŠ¨

```
"å–‚å® ç‰©"    â†’ è§‚å¯Ÿ Feed æ—¥å¿—
"ç©è€"      â†’ è§‚å¯Ÿ Play æ—¥å¿—
"æŠ±æŠ±"      â†’ è§‚å¯Ÿ Hug æ—¥å¿—ï¼ˆä¿¡ä»»åº¦å¢é•¿ï¼‰
```

**é¢„æœŸçœ‹åˆ°**ï¼š
```
I (xxx) Pet: ğŸ” Fed pet +20, Satiety: 19 -> 39
I (xxx) EmotionalMemory: ğŸ’ Feed: happiness=0.05â†‘, loneliness=40â†“

I (xxx) Pet: ğŸ¾ Played with pet, Mood: 37, Active: 58
I (xxx) EmotionalMemory: ğŸ’ Play: excitement=65â†‘, loneliness=20â†“, happiness=0.15

I (xxx) Pet: ğŸ¤— Hugged pet, Mood: 42
I (xxx) EmotionalMemory: ğŸ’ Hug: trust=53â†‘ (total hugs=1), happiness=0.23â†‘
```

### 5. é‡å¤ 50+ æ¬¡

**ç›®æ ‡**ï¼šè®©äº’åŠ¨æ¬¡æ•°è¾¾åˆ° 50+

**æ“ä½œ**ï¼š
```bash
# åœ¨å¯¹è¯ä¸­é‡å¤ï¼š
"å–‚å® ç‰©"
"ç©è€"
"æŸ¥è¯¢çŠ¶æ€"
```

**é¢„æœŸå˜åŒ–**ï¼š
```
// åˆå§‹ï¼ˆ5æ¬¡äº’åŠ¨ï¼‰
I (xxx) Pet: ğŸ”„ Decay: adaptive_rate=0.60x (7däº’åŠ¨=5æ¬¡), ...

// 20æ¬¡å
I (xxx) Pet: ğŸ”„ Decay: adaptive_rate=1.00x (7däº’åŠ¨=20æ¬¡), ...

// 50æ¬¡å
I (xxx) Pet: ğŸ”„ Decay: adaptive_rate=1.30x (7däº’åŠ¨=52æ¬¡), ...
```

---

## âœ¨ æ€»ç»“

### âœ… å·²å®Œæˆ

1. âœ… æ·»åŠ  `self.pet.set_state` å·¥å…·ï¼ˆAI å¯ç›´æ¥è®¾ç½®å±æ€§ï¼‰
2. âœ… å¢å¼ºæ‰€æœ‰è‡ªé€‚åº”æ—¥å¿—å¯è§æ€§ï¼ˆDEBUG â†’ INFOï¼‰
3. âœ… å¢å¼ºæƒ…ç»ªè®°å¿†æ—¥å¿—å¯è§æ€§
4. âœ… æ—¥å¿—æ˜¾ç¤ºäº’åŠ¨æ¬¡æ•°å’Œè¡°å‡é€Ÿç‡å…³ç³»

### ğŸ“Š ç°åœ¨æ‚¨å¯ä»¥çœ‹åˆ°

- âœ… æ¯æ¬¡è¡°å‡ï¼šè¡°å‡é€Ÿç‡ + äº’åŠ¨æ¬¡æ•°
- âœ… æ¯æ¬¡å–‚é£Ÿï¼šæƒ…ç»ªå˜åŒ–
- âœ… æ¯æ¬¡ç©è€ï¼šå…´å¥‹åº¦å’Œå­¤ç‹¬æ„Ÿå˜åŒ–
- âœ… æ¯æ¬¡æ‹¥æŠ±ï¼šä¿¡ä»»åº¦å¢é•¿

### ğŸ¯ ä¸‹ä¸€æ­¥

ç¼–è¯‘å¹¶æµ‹è¯•ï¼š
```bash
cd /Users/machenyang/Desktop/xiaozhi-esp32-main
idf.py build flash monitor
```

ç„¶ååœ¨å¯¹è¯ä¸­ï¼š
```
"æŠŠæ¸…æ´åº¦è®¾ç½®åˆ°10"      â†’ æµ‹è¯•æ–°å·¥å…·
"å–‚å® ç‰©"ï¼ˆé‡å¤ 50 æ¬¡ï¼‰  â†’ è§‚å¯Ÿè¡°å‡é€Ÿç‡å˜åŒ–
"æŠ±æŠ±"ï¼ˆé‡å¤ 10 æ¬¡ï¼‰    â†’ è§‚å¯Ÿä¿¡ä»»åº¦å¢é•¿
```

**ç°åœ¨è‡ªé€‚åº”å’Œæƒ…ç»ªç´¯ç§¯çš„æ•ˆæœå®Œå…¨å¯è§ï¼** ğŸ‰


