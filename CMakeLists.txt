# For more information about build system see
# https://docs.espressif.com/projects/esp-idf/en/latest/api-guides/build-system.html
# The following five lines of boilerplate have to be in your project's
# CMakeLists in this exact order for cmake to work correctly
cmake_minimum_required(VERSION 3.16)

set(PROJECT_VER "2.0.3")

# Add this line to disable the specific warning
add_compile_options(-Wno-missing-field-initializers)

# ğŸ›¡ï¸ è‡ªåŠ¨æ£€æŸ¥å¹¶åº”ç”¨ VADNet1 è¡¥ä¸ï¼ˆé˜²æ­¢ managed_components ä¿®æ”¹ä¸¢å¤±ï¼‰
set(PATCH_CHECK_FILE "${CMAKE_CURRENT_SOURCE_DIR}/managed_components/espressif__esp-sr/src/model_path.c")
set(PATCH_SCRIPT "${CMAKE_CURRENT_SOURCE_DIR}/apply_vadnet1_fix.sh")

if(EXISTS "${PATCH_CHECK_FILE}")
    # æ£€æŸ¥è¡¥ä¸æ ‡è®°æ˜¯å¦å­˜åœ¨
    file(READ "${PATCH_CHECK_FILE}" PATCH_FILE_CONTENT)
    string(FIND "${PATCH_FILE_CONTENT}" "[PATCH] Clear old static_srmodels cache" PATCH_FOUND)
    
    if(PATCH_FOUND EQUAL -1)
        message(WARNING "âš ï¸  æ£€æµ‹åˆ° VADNet1 è¡¥ä¸ç¼ºå¤±ï¼Œæ­£åœ¨è‡ªåŠ¨åº”ç”¨...")
        if(EXISTS "${PATCH_SCRIPT}")
            execute_process(
                COMMAND bash "${PATCH_SCRIPT}"
                WORKING_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}"
                RESULT_VARIABLE PATCH_RESULT
                OUTPUT_VARIABLE PATCH_OUTPUT
                ERROR_VARIABLE PATCH_ERROR
            )
            if(PATCH_RESULT EQUAL 0)
                message(STATUS "âœ… VADNet1 è¡¥ä¸å·²è‡ªåŠ¨åº”ç”¨æˆåŠŸ")
            else()
                message(WARNING "âš ï¸  è¡¥ä¸åº”ç”¨å¤±è´¥ï¼š${PATCH_ERROR}")
            endif()
        else()
            message(WARNING "âš ï¸  è¡¥ä¸è„šæœ¬ä¸å­˜åœ¨ï¼š${PATCH_SCRIPT}")
        endif()
    else()
        message(STATUS "âœ… VADNet1 è¡¥ä¸å·²å­˜åœ¨ï¼Œæ— éœ€é‡æ–°åº”ç”¨")
    endif()
endif()

include($ENV{IDF_PATH}/tools/cmake/project.cmake)
project(xiaozhi)

